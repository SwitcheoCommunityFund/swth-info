"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    Object.defineProperty(o, k2, { enumerable: true, get: function() { return m[k]; } });
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
};
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
};
Object.defineProperty(exports, "__esModule", { value: true });
exports.HDWallet = void 0;
var bip39 = __importStar(require("bip39"));
var hdkey_1 = __importDefault(require("hdkey"));
var bip44_constants_1 = __importDefault(require("bip44-constants"));
var wif_1 = __importDefault(require("wif"));
var constants_1 = require("../constants");
var HDWallet = /** @class */ (function () {
    function HDWallet() {
    }
    HDWallet.newWallet = function () {
        var mnemonic = bip39.generateMnemonic();
        var seed = bip39.mnemonicToSeed(mnemonic);
        var root = hdkey_1.default.fromMasterSeed(seed);
        return this.getWalletResult(root, mnemonic);
    };
    HDWallet.getWallet = function (mnemonic, skipValidate) {
        if (!skipValidate && !bip39.validateMnemonic(mnemonic)) {
            throw new Error('bad mnemonic from mnemonic by validateMnemonic');
        }
        var seed = bip39.mnemonicToSeedSync(mnemonic, '');
        var root = hdkey_1.default.fromMasterSeed(seed);
        return this.getWalletResult(root, mnemonic);
    };
    HDWallet.getWalletResult = function (root, mnemonic) {
        var _a;
        return _a = {},
            _a[constants_1.Blockchain.Ethereum] = this.getKey(root, this.getCoinType(constants_1.Blockchain.Ethereum), "hex" /* hex */),
            _a[constants_1.Blockchain.Neo] = this.getKey(root, this.getCoinType(constants_1.Blockchain.Neo), "wif" /* wif */),
            _a.mnemonic = mnemonic,
            _a;
    };
    HDWallet.getCoinType = function (blockchain) {
        var coins = bip44_constants_1.default.filter(function (item) { return item[1] === blockchain.toUpperCase(); });
        if (coins.length != 1) {
            throw new Error('Could not find maching bip44 constant');
        }
        var id = coins[0][0];
        return id - 0x80000000;
    };
    HDWallet.getKey = function (root, coinType, format) {
        // m/purpose'/coin_type'/account'/change/address_index
        var addrNode = root.derive("m/44'/" + coinType + "'/0'/0/0");
        switch (format) {
            case 'wif':
                return wif_1.default.encode(128, addrNode._privateKey, true);
            case 'hex':
                return addrNode._privateKey.toString('hex');
            default:
                throw new Error('unknown getKey format');
        }
    };
    return HDWallet;
}());
exports.HDWallet = HDWallet;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiaGR3YWxsZXQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi9zcmMvbGliL3V0aWxzL2hkd2FsbGV0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFBQSwyQ0FBOEI7QUFDOUIsZ0RBQXlCO0FBQ3pCLG9FQUE0QztBQUM1Qyw0Q0FBcUI7QUFFckIsMENBQXlDO0FBWXpDO0lBQUE7SUFvREEsQ0FBQztJQW5EZSxrQkFBUyxHQUF2QjtRQUNFLElBQU0sUUFBUSxHQUFXLEtBQUssQ0FBQyxnQkFBZ0IsRUFBRSxDQUFBO1FBRWpELElBQU0sSUFBSSxHQUFRLEtBQUssQ0FBQyxjQUFjLENBQUMsUUFBUSxDQUFDLENBQUE7UUFDaEQsSUFBTSxJQUFJLEdBQVUsZUFBSyxDQUFDLGNBQWMsQ0FBQyxJQUFJLENBQUMsQ0FBQTtRQUU5QyxPQUFPLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxFQUFFLFFBQVEsQ0FBQyxDQUFBO0lBQzdDLENBQUM7SUFFYSxrQkFBUyxHQUF2QixVQUF3QixRQUFnQixFQUFFLFlBQXNCO1FBQzlELElBQUksQ0FBQyxZQUFZLElBQUksQ0FBQyxLQUFLLENBQUMsZ0JBQWdCLENBQUMsUUFBUSxDQUFDLEVBQUU7WUFDdEQsTUFBTSxJQUFJLEtBQUssQ0FBQyxnREFBZ0QsQ0FBQyxDQUFBO1NBQ2xFO1FBQ0QsSUFBTSxJQUFJLEdBQVEsS0FBSyxDQUFDLGtCQUFrQixDQUFDLFFBQVEsRUFBRSxFQUFFLENBQUMsQ0FBQTtRQUN4RCxJQUFNLElBQUksR0FBVSxlQUFLLENBQUMsY0FBYyxDQUFDLElBQUksQ0FBQyxDQUFBO1FBRTlDLE9BQU8sSUFBSSxDQUFDLGVBQWUsQ0FBQyxJQUFJLEVBQUUsUUFBUSxDQUFDLENBQUE7SUFDN0MsQ0FBQztJQWdCYyx3QkFBZSxHQUE5QixVQUErQixJQUFXLEVBQUUsUUFBZ0I7O1FBQzFEO1lBQ0UsR0FBQyxzQkFBVSxDQUFDLFFBQVEsSUFBRyxJQUFJLENBQUMsTUFBTSxDQUNoQyxJQUFJLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxzQkFBVSxDQUFDLFFBQVEsQ0FBQyxrQkFBdUI7WUFDcEUsR0FBQyxzQkFBVSxDQUFDLEdBQUcsSUFBRyxJQUFJLENBQUMsTUFBTSxDQUMzQixJQUFJLEVBQUUsSUFBSSxDQUFDLFdBQVcsQ0FBQyxzQkFBVSxDQUFDLEdBQUcsQ0FBQyxrQkFBdUI7WUFDL0QsV0FBUSxXQUFBO2VBQ1Q7SUFDSCxDQUFDO0lBRWMsb0JBQVcsR0FBMUIsVUFBMkIsVUFBc0I7UUFDL0MsSUFBTSxLQUFLLEdBQUcseUJBQWMsQ0FBQyxNQUFNLENBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxJQUFJLENBQUMsQ0FBQyxDQUFDLEtBQUssVUFBVSxDQUFDLFdBQVcsRUFBRSxFQUFwQyxDQUFvQyxDQUFDLENBQUE7UUFDakYsSUFBSSxLQUFLLENBQUMsTUFBTSxJQUFJLENBQUMsRUFBRTtZQUNyQixNQUFNLElBQUksS0FBSyxDQUFDLHVDQUF1QyxDQUFDLENBQUE7U0FDekQ7UUFDRCxJQUFNLEVBQUUsR0FBRyxLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUE7UUFDdEIsT0FBTyxFQUFFLEdBQUcsVUFBVSxDQUFBO0lBQ3hCLENBQUM7SUEvQmMsZUFBTSxHQUFHLFVBQUMsSUFBVyxFQUFFLFFBQWdCLEVBQUUsTUFBd0I7UUFDOUUsc0RBQXNEO1FBQ3RELElBQU0sUUFBUSxHQUFRLElBQUksQ0FBQyxNQUFNLENBQUMsV0FBUyxRQUFRLGFBQVUsQ0FBQyxDQUFBO1FBRTlELFFBQVEsTUFBTSxFQUFFO1lBQ2QsS0FBSyxLQUFLO2dCQUNSLE9BQU8sYUFBRyxDQUFDLE1BQU0sQ0FBQyxHQUFHLEVBQUUsUUFBUSxDQUFDLFdBQVcsRUFBRSxJQUFJLENBQUMsQ0FBQTtZQUNwRCxLQUFLLEtBQUs7Z0JBQ1IsT0FBTyxRQUFRLENBQUMsV0FBVyxDQUFDLFFBQVEsQ0FBQyxLQUFLLENBQUMsQ0FBQTtZQUM3QztnQkFDRSxNQUFNLElBQUksS0FBSyxDQUFDLHVCQUF1QixDQUFDLENBQUE7U0FDM0M7SUFDSCxDQUFDLENBQUE7SUFvQkgsZUFBQztDQUFBLEFBcERELElBb0RDO0FBcERZLDRCQUFRIn0=